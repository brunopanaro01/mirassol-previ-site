<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pró-Gestão — Mirassol-Previ</title>
  <meta name="description" content="Portal de Transparência do Mirassol-Previ — acesso a certidões, relatórios, pareceres, despesas e receitas."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand-900:#01385f; --brand-800:#014c85;
      --bg:#f7fafc; --paper:#fff; --ink:#0f172a; --muted:#475569;
      --line:#e2e8f0; --soft:#f3f7fb; --shadow:0 10px 30px rgba(2,8,23,.08);
      --warn:#b45309;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--ink);line-height:1.6}
    a{color:var(--brand-800);text-decoration:none}
    img{max-width:100%;height:auto;display:block}

    /* Anti-popup (bloqueia qualquer modal legado) */
    #popup,.popup,.modal,.modal-backdrop,[role="dialog"],.overlay,.newsletter-modal,.cookie-modal{display:none!important}
    body.modal-open{overflow:auto!important}

    /* Cabeçalho padrão */
    header.site-header{position:sticky;top:0;z-index:100;background:#fff;border-bottom:1px solid var(--line)}
    .header-wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:52px;height:52px}
    .brand .titles{display:flex;flex-direction:column}
    .brand .titles h1{margin:0;font-size:20px;color:var(--brand-800)}
    .brand .titles small{font-size:12px;color:var(--muted)}
    nav.primary{margin-left:auto;position:relative}

    .menu{display:flex;gap:8px;align-items:center}
    .menu a,.menu button{padding:10px 12px;border-radius:10px;color:var(--ink);background:transparent;border:0;font:inherit;cursor:pointer}
    .menu a:hover,.menu button:hover{background:#eef5fb}
    .menu a.active{background:#eef5fb}

    /* Submenu “Institucional” */
    .has-sub{position:relative}
    .has-sub > button{display:inline-flex;align-items:center;gap:6px}
    .submenu{
      display:none;position:absolute;top:100%;left:0;z-index:101;
      background:#fff;border:1px solid var(--line);border-radius:12px;
      box-shadow:var(--shadow);min-width:260px;padding:6px
    }
    .submenu a{display:block;padding:10px 12px;border-radius:8px}
    .submenu a:hover{background:var(--soft)}
    .has-sub:hover .submenu,
    .has-sub:focus-within .submenu{display:block}

    /* Botão hambúrguer */
    .hamb{display:none;background:none;border:0;padding:8px;border-radius:10px;cursor:pointer}
    .hamb:hover{background:#eef5fb}

    /* Conteúdo */
    main{padding:40px 16px}
    .container{max-width:1200px;margin:0 auto}
    h1.page-title{text-align:center;font-size:clamp(1.6rem,1.2rem + 1vw,2.2rem);color:var(--brand-900);margin:0 0 14px}
    .lead{max-width:860px;margin:0 auto 18px;color:var(--muted);text-align:center}

    /* Aviso de links externos */
    .notice{
      max-width:980px;margin:0 auto 20px;
      background:#fff;border:1px solid var(--line);border-left:6px solid var(--warn);
      border-radius:14px;box-shadow:var(--shadow);padding:14px 16px
    }
    .notice strong{display:block;color:#7c2d12;margin-bottom:4px}
    .notice p{margin:0;color:var(--muted);font-size:14px}
    .notice code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.95em}

    /* Seções */
    .section-title{
      margin:24px 0 10px;
      font-size:14px;letter-spacing:.06em;text-transform:uppercase;
      color:#334155
    }

    .cards-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:18px
    }
    .card{
      background:var(--paper);border:1px solid var(--line);border-radius:16px;
      padding:18px;text-align:center;box-shadow:var(--shadow);
      transition:transform .25s ease,box-shadow .25s ease
    }
    .card:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(2,8,23,.12)}
    .card a{font-weight:650;font-size:15.5px;color:var(--brand-800);display:inline-block}
    .badge{
      display:inline-block;margin-top:10px;
      font-size:12px;color:#0f172a;background:var(--soft);
      border:1px solid var(--line);padding:4px 10px;border-radius:999px
    }

    .voltar{display:block;text-align:center;margin:28px auto 0;font-weight:650;color:var(--brand-800)}

    /* Rodapé central */
    footer.site-footer{background:#0d2636;color:#cbd5e1;margin-top:40px}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:20px 16px;text-align:center}

    /* Scroll reveal */
    .reveal{opacity:0;transform:translateY(14px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:none}

    /* Mobile */
    @media(max-width:860px){
      .hamb{display:inline-grid;place-items:center}
      .menu{
        display:none;position:absolute;top:64px;right:16px;background:#fff;border:1px solid var(--line);
        box-shadow:var(--shadow);padding:8px;border-radius:12px;flex-direction:column;min-width:280px
      }
      .menu.show{display:flex}
      .brand .titles h1{font-size:18px}
      .brand img{width:44px;height:44px}
      .has-sub .submenu{position:static;box-shadow:none;border:0;padding:0;margin-left:8px;margin-bottom:8px;display:none}
      .has-sub.open .submenu{display:block}
    }
  </style>
  <style>
/* ===== Painel Pró-Gestão (embutido) ===== */

:root{ --prim:#014c85; --borda:#e5e7eb; --muted:#64748b; --bg:#ffffff; --sidebar:#f9fafb; }
*{box-sizing:border-box;margin:0;padding:0}



.app{display:flex;flex-direction:column;height:100%}
.main{display:grid;grid-template-columns:280px 1fr;gap:0;flex:1 1 auto;min-height:0}
/* Sidebar */
.sidebar{border-right:1px solid var(--borda);background:var(--sidebar);display:flex;flex-direction:column;min-height:0}
.sidebar-
.sidebar-note{padding:6px 14px;font-size:12px;color:#334155;background:#f6f7fb;border-bottom:1px solid #eaeef3}
.sidebar-scroll{overflow:auto;flex:1 1 auto;padding:6px 0}
.acc-item{margin-bottom:6px}
.acc-btn{width:100%;text-align:left;border:none;background:#fff;padding:10px 12px;font-size:14px;font-weight:bold;cursor:pointer;border-top:1px solid var(--borda)}
.acc-links{display:none;padding:6px 0;background:#fff;border-top:1px dashed #e2e8f0}
.acc-links a{display:block;padding:6px 14px;font-size:13px;text-decoration:none;color:#0f172a}
.acc-links a:hover{background:#eef2f7}
/* Content */
.content{display:flex;flex-direction:column;min-width:0;min-height:0}
.toolbar{padding:8px 12px;border-bottom:1px solid var(--borda);background:#f8fafc;color:#014c85;font-weight:bold;font-size:14px;flex:0 0 auto;display:flex;gap:8px;align-items:center;justify-content:space-between}
.viewer{flex:1 1 auto;min-height:0;overflow:auto;padding:16px}
.section{max-width:1100px;margin:0 auto}
.card{ background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.06); overflow:hidden; border:1px solid var(--borda) }
.card-pad{ padding:16px }
.muted{color:#64748b;font-size:13px}
h2{color:#014c85;margin-bottom:8px}
.notice{padding:12px;border:1px dashed #cbd5e1;border-radius:8px;background:#fafafa;color:#475569}
.link-out{color:#014c85;text-decoration:none;font-weight:bold}
.link-out:hover{text-decoration:underline}
/* GRID de membros (tipo planilha) */
.grid-wrap{margin-top:8px}
.membros-grid{
  display:grid;
  grid-template-columns: 110px 1.1fr 1fr;
  gap:10px 14px;
  align-items:center;
}
.membros-grid .head{
  font-weight:bold; color:#0f172a; background:#f3f6fb; border:1px solid var(--borda);
  padding:10px; border-radius:8px;
}
.membros-grid .cell{
  border:1px solid var(--borda); border-radius:8px; padding:10px; background:#fff;
}
.membros-grid .foto{ display:flex; align-items:center; justify-content:center; }
.membros-grid img{ width:84px; height:84px; object-fit:cover; border-radius:8px; display:block; }
.membros-grid .nome{ font-weight:bold; }
.membros-grid .cargo{ color:#475569; }
/* Cronograma */
.years{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 16px}
.year-btn{padding:8px 12px;border:1px solid var(--borda);border-radius:8px;background:#fff;cursor:pointer;font-size:14px}
.year-btn.active{background:#014c85;color:#fff;border-color:#014c85}
.dates{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-bottom:16px}
.date-card{border:1px solid var(--borda);border-radius:8px;padding:10px;background:#fff;cursor:pointer}
.date-card h4{margin:0 0 6px;font-size:14px;color:#0f172a}
.date-card .tag{font-size:12px;color:#475569}
.detail{border:1px solid var(--borda);border-radius:10px;padding:14px;background:#fff}
.detail h3{margin:0 0 8px;color:#0f172a}
.detail-item{margin-bottom:6px}
.empty{padding:16px;border:1px dashed #cbd5e1;border-radius:10px;background:#fafafa;color:#64748b}
.list{margin:8px 0 0 18px}
/* Footer */
.footer{flex:0 0 auto;border-top:1px solid var(--borda);padding:10px 0;background:#fff}
.back-btn{display:block;margin:0 auto;padding:8px 14px;background:#014c85;color:white;border-radius:6px;text-decoration:none;width:fit-content}
.back-btn:hover{background:#003f6d}
@media (max-width: 900px){
  .main{grid-template-columns:1fr}
  .membros-grid{ grid-template-columns: 80px 1fr; }
  .membros-grid .head:nth-child(3),
  .membros-grid .cell.cargo{ grid-column: 1 / span 2; }
}

/* Tabela planejamento educação */
.table{width:100%;border-collapse:collapse;margin-top:8px;background:#fff}
.table th,.table td{border:1px solid var(--borda);padding:10px;text-align:left;vertical-align:top;font-size:14px}
.table th{background:#f3f6fb;color:#0f172a}
.badge{display:inline-block;border:1px solid var(--borda);border-radius:999px;padding:2px 8px;font-size:12px;color:#334155;background:#f8fafc}


/* Ajustes para integrar ao layout do site */
.pg-wrap{margin-top:18px}
.pg-wrap .app{height:auto}
.pg-wrap .main{min-height:520px}
@media(max-width:900px){.pg-wrap .main{min-height:auto}}
  </style>
</head>

<body>
  <!-- Cabeçalho -->
  <header class="site-header">
    <div class="header-wrap">
      <a class="brand" href="index.html" aria-label="Ir para a página inicial">
        <img src="brasao.png" alt="Brasão de Mirassol D'Oeste"/>
        <span class="titles">
          <h1>Mirassol-Previ</h1>
          <small>Fundo Municipal de Previdência Social — Mirassol D’Oeste/MT</small>
        </span>
      </a>

      <button class="hamb" aria-label="Abrir menu" aria-controls="menu" aria-expanded="false">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav class="primary" aria-label="Menu principal">
        <div id="menu" class="menu" role="menubar">
          <a role="menuitem" href="index.html">Início</a>
          <div class="has-sub" role="none">
            <button aria-haspopup="true" aria-expanded="false">Institucional ▾</button>
            <div class="submenu" role="menu">
              <a role="menuitem" href="historia.html">História</a>
              <a role="menuitem" href="identidade.html">Identidade</a>
              <a role="menuitem" href="composicao.html">Composição</a>
              <a role="menuitem" href="organograma.html">Organograma</a>
            </div>
          </div>
          <a role="menuitem" href="aposentadorias.html">Aposentadorias</a>
          <a role="menuitem" class="active" href="transparencia.html">Transparência</a>
          <a role="menuitem" href="progestao.html">Pró-Gestão</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Conteúdo -->
  <main>

    <section class="hero reveal">
      <h2>Pró-Gestão RPPS</h2>
      <p>Documentos, evidências e painéis de acompanhamento para atendimento aos requisitos do Pró-Gestão RPPS.</p>
    </section>

    <div class="pg-wrap reveal">
<div class="app">
  

  <div class="main">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">Pró-Gestão</div>
      <div class="sidebar-note">Obs.: Os documentos/sistemas externos abrem em <strong>nova aba</strong>. Já <strong>Composição</strong> abre aqui no painel.</div>
      <div class="sidebar-scroll">

        <!-- Conselho -->
        <div class="acc-item">
          <button class="acc-btn">Conselho Previdenciário</button>
          <div class="acc-links">
            <a href="#" data-compose="conselho">Composição (abrir aqui)</a>
            <a href="https://scpimirassoldoeste.fassilcloud.net:879/transparenciaiprem/?AcessoIndividual=lnkConselhoMunicipal" target="_blank" rel="noopener">Atas (nova aba)</a>
            <a href="https://drive.google.com/file/d/1sXiz6pPNbu9KVozx-VrEzw67omgxDIsH/view?usp=sharing" target="_blank" rel="noopener">Resoluções (nova aba)</a>
            <a href="#" data-cronograma="conselho">Cronograma de Reuniões (abrir aqui)</a>
          </div>
        </div>

        <!-- Comitê -->
        <div class="acc-item">
          <button class="acc-btn">Comitê de Investimentos</button>
          <div class="acc-links">
            <a href="#" data-compose="comite">Composição (abrir aqui)</a>
            <a href="https://scpimirassoldoeste.fassilcloud.net:879/transparenciaiprem/?AcessoIndividual=lnkConselhoMunicipal" target="_blank" rel="noopener">Atas (nova aba)</a>
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/Documentos?tipo=108&Pag=CompostoConselhoFiscal&Desc=Conselho%20Fiscal&OrdenaNovo=False#collapse_2710" target="_blank" rel="noopener">Resoluções (nova aba)</a>
            <a href="#" data-cronograma="comite">Cronograma de Reuniões (abrir aqui)</a>
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/Documentos?tipo=61&Pag=CompostoInvestimentos&Desc=Comit%C3%AA%20de%20Investimentos&OrdenaNovo=False" target="_blank" rel="noopener">Relatórios Mensais (nova aba)</a>
          </div>
        </div>

        <!-- Demais itens -->
        <div class="acc-item">
          <button class="acc-btn">Audiência Pública</button>
          <div class="acc-links">
            <a href="https://www.youtube.com/live/MdlUxoW7kc0?si=AVoUmAhaL1LykV-K" target="_blank" rel="noopener">Visualizar (nova aba)</a>
          </div>
        </div>
        
        <div class="acc-item">
          <button class="acc-btn">Reavaliação Atuarial</button>
          <div class="acc-links">
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/Documentos?tipo=81&Pag=CertificadosDemonstrativos&Pag2=CertificadosDemonstrativosDRAA" target="_blank" rel="noopener">Visualizar (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Plano de Custeio</button>
          <div class="acc-links">
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/Documentos?tipo=81&Pag=CertificadosDemonstrativos&Pag2=CertificadosDemonstrativosDRAA" target="_blank" rel="noopener">Visualizar (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Política Anual de Investimento</button>
          <div class="acc-links">
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/Documentos?tipo=7&Pag=CompostoGestaoCarteiraRpps" target="_blank" rel="noopener">Visualizar (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Investimentos</button>
          <div class="acc-links">
            <a href="https://www.consultatransparencia.com.br/mirassoldoestenovo/Transparencia/PortifolioInvestimento" target="_blank" rel="noopener">Portfólio (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Certidões</button>
          <div class="acc-links">
            <a href="certidoes.html" target="_blank" rel="noopener">Visualizar Certidões (nova aba)</a>
          </div>
        </div>
         <div class="acc-item">
          <button class="acc-btn">Educação Previdenciária</button>
          <div class="acc-links">
            <a href="#" data-educacao="planejamento">Planejamento de Capacitação (abrir aqui)</a>
            <a href="https://drive.google.com/file/d/1xHL5V9AfRJgKgvvgDUT6zSetc9FkhNUi/view?usp=sharing" target="_blank" rel="noopener">Cartilha Previdenciária (nova aba)</a>
          </div>
        </div>
        <div class="acc-item">
          <button class="acc-btn">Código de Ética</button>
          <div class="acc-links">
            <a href="https://drive.google.com/file/d/1L6lEL6Yijihv4GcEvy3sMsrpkpqRcZ--/view?usp=sharing" target="_blank" rel="noopener">Abrir Código de Ética (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Política de Informação</button>
          <div class="acc-links">
            <a href="https://drive.google.com/file/d/1m7K5CDBqZG6PbbXwNrKYy40ffFiy2Mgb/view?usp=sharing" target="_blank" rel="noopener">Abrir Política de Informação (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Plano de Ação</button>
          <div class="acc-links">
            <a href="https://drive.google.com/file/d/1jyK8EfceX4YnIDvbnt2OrKJsd3sR54NZ/view?usp=sharing" target="_blank" rel="noopener">Abrir Plano de Ação (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Relatório de Governança</button>
          <div class="acc-links">
            <a href="https://drive.google.com/file/d/1F1DTjP9cTLsPeUWkVq6pKT4XupLZqI7U/view?usp=sharing" target="_blank" rel="noopener">2024 (nova aba)</a>
          </div>
        </div>

        <div class="acc-item">
          <button class="acc-btn">Consulta CRP</button>
          <div class="acc-links">
            <a href="https://cadprev.previdencia.gov.br/Cadprev/pages/publico/crp/pesquisarEnteCrp.xhtml" target="_blank" rel="noopener">Abrir Consulta CRP (nova aba)</a>
          </div>
        </div>

      </div>
    </aside>

    <!-- Content -->
    <main class="content">
      <div class="toolbar" id="viewTitle">
        <span>Selecione um item</span>
        <label class="muted" style="font-size:12px"></label>
      </div>
      <div class="viewer">
        <div class="section" id="contentArea">
          <div class="notice">Clique em <b>Composição</b> do Conselho ou do Comitê para ver os membros aqui no painel (layout em grade: <i>foto • nome • cargo</i>). Para cronograma, escolha “Cronograma de Reuniões”.</div>
        </div>
      </div>
      </main>

  </div>
</div>

<script>
// Accordion (menu lateral)
document.querySelectorAll('.acc-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const panel = btn.nextElementSibling;
    const open = panel.style.display === 'block';
    document.querySelectorAll('.acc-links').forEach(el => el.style.display = 'none');
    panel.style.display = open ? 'none' : 'block';
  });
});

const titleEl = document.getElementById('viewTitle').querySelector('span');
const contentArea = document.getElementById('contentArea');

// Sanitização simples
function sanitize(html){
  const template = document.createElement('template');
  template.innerHTML = html;
  const allowed = ['H1','H2','H3','H4','H5','H6','P','UL','OL','LI','STRONG','EM','B','I','SPAN','DIV','TABLE','THEAD','TBODY','TR','TH','TD','BR','IMG'];
  const walker = document.createTreeWalker(template.content, NodeFilter.SHOW_ELEMENT, null);
  let node;
  const toRemove = [];
  while(node = walker.nextNode()){
    if(!allowed.includes(node.tagName)){
      toRemove.push(node);
    }else{
      [...node.attributes].forEach(attr=>{
        const name = attr.name.toLowerCase();
        if(!['class','id','style','colspan','rowspan','scope','align','src','alt'].includes(name)){
          node.removeAttribute(attr.name);
        }
      });
    }
  }
  toRemove.forEach(n=>n.replaceWith(...n.childNodes));
  return template.innerHTML;
}

// Constrói GRID padronizado de membros (foto | nome | cargo)
function buildGridFromBlock(blockEl){
  let items = Array.from(blockEl.querySelectorAll('.card, .membro, .item, .perfil, li, .grid-item, .col'))
    .filter(el => el.querySelector('img') || /<img/i.test(el.innerHTML));
  if(items.length === 0){
    items = Array.from(blockEl.children).filter(el => el.querySelector && el.querySelector('img'));
  }
  const rows = [];
  items.forEach(el => {
    const img = el.querySelector('img');
    let nomeEl = el.querySelector('h3, h4, .nome, strong, b');
    let nome = nomeEl ? nomeEl.textContent.trim() : '';
    if(!nome){
      const txt = el.textContent.trim().split('\n').map(s=>s.trim()).filter(Boolean)[0] || '';
      nome = txt;
    }
    let cargoEl = el.querySelector('.cargo, .funcao');
    if(!cargoEl){
      const ps = Array.from(el.querySelectorAll('p, span')).map(x=>x.textContent.trim()).filter(Boolean);
      cargoEl = {textContent: ps.slice(1).join(' • ') || ps[0] || ''};
    }
    const cargo = (cargoEl && cargoEl.textContent) ? cargoEl.textContent.trim() : '';
    rows.push({ foto: img ? img.getAttribute('src') : '', nome, cargo });
  });

  const header = `
    <div class="head">Foto</div>
    <div class="head">Nome</div>
    <div class="head">Cargo / Representação</div>
  `;
  const body = rows.map(r => `
    <div class="cell foto">${ r.foto ? `<img src="${r.foto}" alt="${r.nome||'Membro'}">` : '' }</div>
    <div class="cell nome">${r.nome || '—'}</div>
    <div class="cell cargo">${r.cargo || '—'}</div>
  `).join('');

  return `<div class="grid-wrap"><div class="membros-grid">${header}${body}</div></div>`;
}

// Carrega composicao.html e renderiza em GRID
async function loadComposicao(tipo){ // 'conselho' | 'comite'
  titleEl.textContent = 'Composição — ' + (tipo==='conselho'?'Conselho Previdenciário':'Comitê de Investimentos');
  contentArea.innerHTML = '<div class="card"><div class="card-pad">Carregando composição…</div></div>';
  try{
    const res = await fetch('composicao.html', {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const html = await res.text();
    const doc = new DOMParser().parseFromString(html, 'text/html');

    // Seleciona seção pelo <h2>
    const allH2 = Array.from(doc.querySelectorAll('h2'));
    const targetH2 = allH2.find(h => {
      const t = (h.textContent || '').trim().toLowerCase();
      return (tipo==='conselho' ? t.includes('conselho previdenci') : t.includes('comit'));
    });
    let bloco = null;
    if(targetH2){
      bloco = targetH2.closest('.secao') || targetH2.parentElement;
    }

    if(bloco){
      const safe = sanitize(bloco.outerHTML);
      const tmp = document.createElement('div');
      tmp.innerHTML = safe;
      const inner = tmp.querySelector('.card-container') || tmp;
      const gridHtml = buildGridFromBlock(inner);
      contentArea.innerHTML = `
        <h2 style="margin:0 0 10px;">${tipo==='conselho'?'Conselho Previdenciário':'Comitê de Investimentos'}</h2>
        <div class="card"><div class="card-pad">${gridHtml}</div></div>
      `;
    }else{
      contentArea.innerHTML = `
        <div class="card"><div class="card-pad">
          <div class="notice">
            Não foi possível identificar o bloco de composição em <code>composicao.html</code>.
            Verifique os títulos (“Conselho Previdenciário” / “Comitê”) e a estrutura dos cartões.
            <br><a class="link-out" href="composicao.html" target="_blank" rel="noopener">Abrir composicao.html em nova aba</a>.
          </div>
        </div></div>`;
    }
  }catch(e){
    contentArea.innerHTML = `
      <div class="card"><div class="card-pad">
        <div class="notice">
          Não foi possível carregar <code>composicao.html</code>. (Se estiver em outro domínio, pode haver bloqueio do navegador.)
          <br><a class="link-out" href="composicao.html" target="_blank" rel="noopener">Abrir composicao.html em nova aba</a>.
        </div>
      </div></div>
    `;
  }
}

// Clique em "Composição"
document.querySelectorAll('[data-compose]').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    loadComposicao(a.dataset.compose);
  });
});


// ===== EDUCAÇÃO PREVIDENCIÁRIA (planejamento por ano a partir de educacao.json) =====
let EDUC = null;

function esc(v){
  return (v ?? '').toString();
}
function badge(v){
  const t = esc(v).trim();
  return t ? `<span class="badge">${t}</span>` : '';
}

function tableEduc(rows){
  if(!rows || rows.length===0){
    return '<div class="empty">Nenhum registro cadastrado neste ano.</div>';
  }
  return `
    <div class="card"><div class="card-pad" style="padding-top:12px">
      <table class="table">
        <thead>
          <tr>
            <th style="width:22%;">O QUE (CURSO)</th>
            <th style="width:10%;">ONDE</th>
            <th style="width:10%;">INÍCIO PREVISTO</th>
            <th style="width:10%;">FIM PREVISTO</th>
            <th style="width:16%;">PARTICIPANTES</th>
            <th style="width:20%;">OBJETIVO</th>
            <th style="width:6%;">CARGA HORÁRIA</th>
            <th style="width:6%;">STATUS</th>
          </tr>
        </thead>
        <tbody>
          ${rows.map(r=>`
            <tr>
              <td>${esc(r["O QUE (CURSO)"])}</td>
              <td>${badge(r["ONDE"])}</td>
              <td>${esc(r["INÍCIO PREVISTO"])}</td>
              <td>${esc(r["FIM PREVISTO"])}</td>
              <td>${esc(r["PARTICIPANTES"])}</td>
              <td>${esc(r["OBJETIVO"])}</td>
              <td>${esc(r["CARGA HORÁRIA"])}</td>
              <td>${badge(r["STATUS"])}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      <div class="muted" style="margin-top:10px">
        Fonte: <code>educacao.json</code> (padrão do Plano de Ação de Capacitação).
      </div>
    </div></div>`;
}

function renderEducYears(){
  const years = Object.keys(EDUC || {}).sort();
  if(years.length===0){
    contentArea.innerHTML = '<div class="empty">Não há anos cadastrados no <code>educacao.json</code>.</div>';
    return;
  }
  const last = years[years.length-1];

  contentArea.innerHTML = `
    <h2>Educação Previdenciária — Planejamento anual</h2>
    <div class="muted">Selecione o ano para visualizar a programação de capacitações.</div>
    <div class="years">
      ${years.map(y=>`<button class="year-btn" data-year="${y}">${y}</button>`).join('')}
    </div>
    <div id="educTable"></div>
  `;

  contentArea.querySelectorAll('.year-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      contentArea.querySelectorAll('.year-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const ano = btn.dataset.year;
      const rows = (EDUC && EDUC[ano]) ? EDUC[ano] : [];
      document.getElementById('educTable').innerHTML = tableEduc(rows);
    });
  });

  const lastBtn = contentArea.querySelector(`.year-btn[data-year="${last}"]`);
  if(lastBtn) lastBtn.click();
}

async function ensureEduc(){
  if(EDUC) return true;
  try{
    const res = await fetch('educacao.json', {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    EDUC = await res.json();
    return true;
  }catch(err){
    console.error(err);
    contentArea.innerHTML = '<div class="empty">Não foi possível carregar o <code>educacao.json</code>. Verifique se o arquivo está na mesma pasta desta página e se o nome está correto.</div>';
    return false;
  }
}

document.querySelectorAll('[data-educacao]').forEach(a=>{
  a.addEventListener('click', async (e)=>{
    e.preventDefault();
    titleEl.textContent = 'Educação Previdenciária — Planejamento';
    if(await ensureEduc()){
      renderEducYears();
    }
  });
});


// ===== CRONOGRAMA (carrega de cronograma.json) =====
let CRONO = null;
function formatDateISO(iso){
  if(!iso) return "";
  const d = new Date(iso + "T00:00:00");
  const pad = (n)=> String(n).padStart(2,'0');
  return pad(d.getDate()) + "/" + pad(d.getMonth()+1) + "/" + d.getFullYear();
}
function renderYears(entidade){
  const years = Object.keys(CRONO[entidade] || {}).sort();
  if(years.length === 0){
    contentArea.innerHTML = `<div class="empty">Não há anos cadastrados para ${entidade}.</div>`;
    return;
  }
  const last = years[years.length-1];
  contentArea.innerHTML = `
    <h2>Selecione o ano</h2>
    <div class="muted">Clique no ano e depois na <strong>data</strong> para ver a pauta e o previsto.</div>
    <div class="years">
      ${years.map(y=>`<button class="year-btn" data-year="${y}">${y}</button>`).join('')}
    </div>
    <div id="datesWrap"></div>
    <div id="detailWrap" style="margin-top:14px;"></div>
  `;
  contentArea.querySelectorAll('.year-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      contentArea.querySelectorAll('.year-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      renderDates(entidade, btn.dataset.year);
    });
  });
  const lastBtn = contentArea.querySelector(`.year-btn[data-year="${last}"]`);
  if(lastBtn) lastBtn.click();
}
function renderDates(entidade, ano){
  const wrap = document.getElementById('datesWrap');
  const list = (CRONO[entidade] && CRONO[entidade][ano]) ? CRONO[entidade][ano] : [];
  if(list.length === 0){
    wrap.innerHTML = `<div class="empty">Nenhuma reunião cadastrada em ${ano}.</div>`;
    document.getElementById('detailWrap').innerHTML = '';
    return;
  }
  wrap.innerHTML = `
    <h2>Datas de ${ano}</h2>
    <div class="dates">
      ${list.map((item,idx)=>`
        <div class="date-card" data-idx="${idx}" data-ano="${ano}" data-ent="${entidade}">
          <h4>${formatDateISO(item.data)}</h4>
          <div class="tag">${item.previsto ? ('Previsto: ' + item.previsto) : ''}</div>
        </div>
      `).join('')}
    </div>
  `;
  wrap.querySelectorAll('.date-card').forEach(card=>{
    card.addEventListener('click', ()=>{
      const idx = Number(card.dataset.idx);
      renderDetail(entidade, ano, idx);
    });
  });
  document.getElementById('detailWrap').innerHTML = '';
}
function renderDetail(entidade, ano, idx){
  const item = CRONO[entidade][ano][idx];
  const det = document.getElementById('detailWrap');
  const itens = (item.pauta || '').split(';').map(s => s.trim()).filter(Boolean);
  const lista = itens.length ? `<ul class="list">${itens.map(i=>`<li>${i.replace(/\.$/, '')}</li>`).join('')}</ul>` : '<div class="detail-item">Pauta: —</div>';
  det.innerHTML = `
    <div class="detail">
      <h3>${formatDateISO(item.data)} — Pauta</h3>
      ${lista}
      <div class="detail-item"><strong>Previsto:</strong> ${item.previsto || '—'}</div>
      <div class="muted" style="margin-top:8px">Observação: em atenção à LGPD, documentos (se houver) são disponibilizados separadamente.</div>
    </div>
  `;
}
async function ensureCrono(){
  if(CRONO) return true;
  try{
    const res = await fetch('cronograma.json', {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    CRONO = await res.json();
    return true;
  }catch(err){
    contentArea.innerHTML = '<div class="empty">Não foi possível carregar o cronograma.json. Verifique se o arquivo está na mesma pasta desta página.</div>';
    return false;
  }
}
document.querySelectorAll('[data-cronograma]').forEach(a=>{
  a.addEventListener('click', async (e)=>{
    e.preventDefault();
    const entidade = a.getAttribute('data-cronograma'); // conselho | comite
    titleEl.textContent = 'Cronograma — ' + (entidade === 'conselho' ? 'Conselho Previdenciário' : 'Comitê de Investimentos');
    if(await ensureCrono()){
      renderYears(entidade);
    }
  });
});
</script>
    </div>

</main>

  <!-- Rodapé -->
  <footer class="site-footer">
    <div class="footer-wrap">
      <span>© <span id="year"></span> Mirassol-Previ</span>
    </div>
  </footer>

  <script>
    // Ano dinâmico
    document.getElementById('year').textContent = new Date().getFullYear();

    // Scroll reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));

    // Menu mobile
    const hamb = document.querySelector('.hamb');
    const menu = document.getElementById('menu');
    hamb?.addEventListener('click', ()=>{
      const open = menu.classList.toggle('show');
      hamb.setAttribute('aria-expanded', String(open));
    });

    // Submenu institucional (mobile)
    document.querySelectorAll('.has-sub > button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const parent = btn.closest('.has-sub');
        const isOpen = parent.classList.toggle('open');
        btn.setAttribute('aria-expanded', String(isOpen));
      });
    });

    // Padronização automática de links externos: nova aba + noopener + seta ↗
    const anchors = Array.from(document.querySelectorAll('.card a'));
    anchors.forEach(a=>{
      const href = a.getAttribute('href') || '';
      if(!/^https?:\/\//i.test(href)) return;

      a.setAttribute('target','_blank');
      a.setAttribute('rel','noopener');
      if(!a.textContent.includes('↗')){
        a.textContent = a.textContent.trim() + ' ↗';
      }
    });
  </script>
</body>
</html>
