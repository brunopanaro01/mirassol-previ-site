<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- ============================== META / HEAD =============================== -->
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mirassol-Previ — Fundo Municipal de Previdência</title>
  <meta name="description" content="Site oficial do Mirassol-Previ — Fundo Municipal de Previdência Social dos Servidores de Mirassol D’Oeste - MT."/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- ================================ CSS ===================================== -->
  <style>
    :root{
      --brand-900:#01385f;
      --brand-800:#014c85;
      --brand-700:#03588c;
      --bg:#f7fafc;
      --paper:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --shadow:0 10px 30px rgba(2,8,23,.08);
      --radius:16px;
    }

    /* Reset básico */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      text-rendering:optimizeLegibility;
    }
    img{max-width:100%;height:auto;display:block}
    a{color:var(--brand-800);text-decoration:none}

    /* Anti-popup hardening (bloqueia qualquer modal legado) */
    #popup,.popup,.modal,.modal-backdrop,[role="dialog"],.overlay,.newsletter-modal,.cookie-modal{display:none!important}
    body.modal-open{overflow:auto!important}

    /* ============================== HEADER ==================================== */
    header.site-header{
      position:sticky;top:0;z-index:100;
      background:#fff;border-bottom:1px solid #e2e8f0
    }
    .header-wrap{
      max-width:1200px;margin:0 auto;padding:10px 16px;
      display:flex;align-items:center;gap:16px
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:52px;height:52px}
    .brand .titles{display:flex;flex-direction:column}
    .brand .titles h1{font-size:20px;margin:0;color:var(--brand-800)}
    .brand .titles small{font-size:12px;color:var(--muted)}

    nav.primary{margin-left:auto;position:relative}
    .menu{display:flex;gap:8px;align-items:center}
    .menu a, .menu button{
      padding:10px 12px;border-radius:10px;color:var(--ink);
      background:transparent;border:0;font:inherit;cursor:pointer
    }
    .menu a:hover, .menu button:hover{background:#eef5fb}
    .hamb{display:none;background:none;border:0;padding:8px;border-radius:10px}
    .hamb:focus{outline:2px solid #94a3b8;outline-offset:2px}

    /* Submenu “Institucional” */
    .has-sub{position:relative}
    .has-sub > button{display:inline-flex;align-items:center;gap:6px}
    .submenu{
      display:none;position:absolute;top:100%;left:0;z-index:101;
      background:#fff;border:1px solid #e2e8f0;border-radius:12px;
      box-shadow:var(--shadow);min-width:260px;padding:6px
    }
    .submenu a{display:block;padding:10px 12px;border-radius:8px}
    .submenu a:hover{background:#f3f7fb}
    /* Desktop: abre ao hover/focus */
    .has-sub:focus-within .submenu,
    .has-sub:hover .submenu{display:block}

    /* ============================== HERO ====================================== */
    .hero{background:linear-gradient(180deg,#fff,#f5f9fc 65%)}
    .hero .wrap{
      max-width:1200px;margin:0 auto;padding:56px 16px;
      display:grid;grid-template-columns:1.1fr .9fr;gap:32px;align-items:center
    }
    .hero h2{font-size:34px;line-height:1.15;margin:0 0 10px;color:var(--brand-900)}
    .hero p{color:var(--muted);max-width:56ch;margin:0 0 10px}
    .hero .wrap img.hero-img{
      max-width:360px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.15);
      margin-left:auto
    }

    .cta{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap}
    .btn{appearance:none;border:0;padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--brand-800);color:#fff}
    .btn.primary:hover{background:var(--brand-700)}
    .btn.ghost{background:#eef5fb;color:var(--brand-800)}

    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:24px}
    .kpi{background:var(--paper);border-radius:12px;box-shadow:var(--shadow);padding:16px;text-align:center}
    .kpi b{font-size:26px;color:var(--brand-900)}
    .kpi span{display:block;color:var(--muted);font-size:12px}

    /* ============================== SEÇÕES ==================================== */
    section{padding:56px 16px}
    .container{max-width:1200px;margin:0 auto}
    h2.section-title{font-size:28px;color:var(--brand-900);margin:0 0 24px}

    /* Notícias */
    .grid{display:grid;gap:20px}
    .grid.cards-3{grid-template-columns:repeat(3,1fr)}
    .card{
      background:var(--paper);border-radius:12px;overflow:hidden;
      box-shadow:var(--shadow);display:flex;flex-direction:column;min-height:100%
    }
    .card img{height:180px;object-fit:cover}
    .card .body{padding:16px;display:flex;flex-direction:column;gap:10px}
    .card h3{font-size:18px;margin:0}
    .card p{color:var(--muted);margin:0}
    .card .actions{margin-top:auto}
    .badge{display:inline-block;font-size:11px;padding:4px 8px;background:#eef5fb;color:var(--brand-800);border-radius:999px}
    .link-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:var(--brand-800);color:#fff}
    .link-btn:hover{background:var(--brand-700)}

    /* Números (tabela) */
    table#tabela-numeros{width:100%;background:#fff;border-radius:12px;box-shadow:var(--shadow);border-collapse:collapse}
    table#tabela-numeros thead th{position:sticky;top:0;background:var(--brand-800);color:#fff}
    table#tabela-numeros th, table#tabela-numeros td{padding:12px 14px;text-align:center}
    table#tabela-numeros th:first-child, table#tabela-numeros td:first-child{text-align:left}
    table#tabela-numeros tbody tr:nth-child(odd){background:#fafcff}

    /* Serviços */
    .tiles{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .tile{background:var(--paper);border-radius:14px;box-shadow:var(--shadow);padding:20px;display:grid;place-items:center;text-align:center}
    .tile img{width:84px;height:84px;object-fit:contain;margin-bottom:10px}
    .tile a{font-weight:700}

    /* Links úteis */
    .links{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .link-card{background:var(--paper);border-radius:14px;box-shadow:var(--shadow);padding:18px}
    .link-card h3{margin:0 0 6px;color:var(--brand-900)}
    .link-card p{margin:0;color:var(--muted)}

    /* Contato */
    .contact{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .contact .card{text-align:center;padding-bottom:22px}

    /* ============================== FOOTER ==================================== */
    footer.site-footer{background:#0d2636;color:#cbd5e1}
    .footer-wrap{
      max-width:1200px;margin:0 auto;padding:20px 16px;
      display:flex;gap:16px;align-items:center;justify-content:space-between
    }
    .foot-note{font-size:13px}

    /* WhatsApp flutuante */
    .whatsapp-float{
      position:fixed;right:20px;bottom:20px;z-index:99;width:60px;height:60px;
      border-radius:50%;background:#25d366;display:grid;place-items:center;box-shadow:var(--shadow)
    }
    .whatsapp-float img{width:34px;height:34px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}

    /* Reveal on scroll */
    .reveal{opacity:0;transform:translateY(18px);transition:opacity .6s ease,transform .6s ease}
    .reveal.in{opacity:1;transform:none}

    /* ============================== MEDIA ===================================== */
    @media(max-width:980px){
      .hero .wrap{grid-template-columns:1fr}
      .hero .wrap img.hero-img{margin:20px auto 0}
      .grid.cards-3{grid-template-columns:repeat(2,1fr)}
      .tiles{grid-template-columns:repeat(2,1fr)}
    }
    @media(max-width:860px){
      .menu{display:none;position:absolute;top:64px;right:16px;background:#fff;border:1px solid #e2e8f0;box-shadow:var(--shadow);padding:8px;border-radius:12px;flex-direction:column;min-width:280px}
      .menu.show{display:flex}
      .hamb{display:inline-grid;place-items:center}
      .brand .titles h1{font-size:18px}
      .brand img{width:44px;height:44px}
      /* Submenu em mobile: vira bloco dentro do dropdown */
      .has-sub .submenu{position:static;box-shadow:none;border:0;padding:0;margin-left:8px;margin-bottom:8px;display:none}
      .has-sub.open .submenu{display:block}
    }
    @media(max-width:640px){
      .grid.cards-3{grid-template-columns:1fr}
      .links{grid-template-columns:1fr}
      .contact{grid-template-columns:1fr}
      .tiles{grid-template-columns:1fr}
    }
  
    /* ====================== EVOLUÇÃO PATRIMONIAL (JSON) ======================= */
    .patrimonio{
      background:linear-gradient(180deg,#fff,#f5f9fc 65%);
    }
    .patrimonio .grafico-card{
      background:var(--paper);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:18px;
      overflow:hidden;
    }
    .patrimonio .grafico-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .patrimonio .grafico-head h3{
      margin:0;
      color:var(--brand-900);
      font-size:18px;
    }
    .patrimonio .grafico-head p{
      margin:0;
      color:var(--muted);
      font-size:13px;
      max-width:70ch;
    }
    .bar-chart{
      display:grid;
      gap:12px;
      align-items:end;
      height:360px;
      padding:10px 6px 6px;
      border-bottom:1px solid #e2e8f0;
      overflow:hidden;
    }
    .bar-item{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      min-width:0;
    };
    }
    .bar{
      width:100%;
      max-width:78px;
      border-radius:10px 10px 0 0;
      background:var(--brand-800);
      height:10px;
      transition:height .35s ease;
      box-shadow:0 6px 16px rgba(1,76,133,.18);
    }
    .bar-value{
      font-size:11px;
      font-weight:700;
      color:var(--brand-800);
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .bar-year{
      font-size:12px;
      font-weight:700;
      color:var(--brand-900);
    }
    .patrimonio-note{
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
    }

  </style>
</head>

<body>
  <!-- ============================== HEADER ==================================== -->
  <header class="site-header" role="banner">
    <div class="header-wrap">
      <a class="brand" href="./index.html" aria-label="Ir para a página inicial">
        <img src="brasao.png" alt="Brasão de Mirassol D'Oeste" loading="eager"/>
        <span class="titles">
          <h1>Mirassol-Previ</h1>
          <small>Fundo Municipal de Previdência Social — Mirassol D’Oeste/MT</small>
        </span>
      </a>

      <button class="hamb" aria-label="Abrir menu" aria-controls="menu" aria-expanded="false">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav class="primary" aria-label="Menu principal">
        <div id="menu" class="menu" role="menubar">
          <a role="menuitem" href="./index.html">Início</a>

          <!-- Submenu Institucional -->
          <div class="has-sub" role="none">
            <button aria-haspopup="true" aria-expanded="false">Institucional ▾</button>
            <div class="submenu" role="menu">
              <a role="menuitem" href="historia.html">História</a>
              <a role="menuitem" href="identidade.html">Identidade</a>
              <a role="menuitem" href="composicao.html">Composição</a>
              <a role="menuitem" href="organograma.html">Organograma</a>
            </div>
          </div>

          <a role="menuitem" href="aposentadorias.html">Aposentadorias</a>
          <a role="menuitem" href="transparencia.html">Transparência</a>
          <a role="menuitem" href="progestao.html">Pró-Gestão</a>
          <a role="menuitem" href="https://mirassoldoeste.flowdocs.com.br:2053/public/home/group/5" target="_blank" rel="noopener">Ouvidoria</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- ================================ HERO ==================================== -->
  <section class="hero">
    <div class="wrap container">
      <div class="reveal">
        <h2>Transparência, segurança e serviço ao segurado</h2>
        <p>Acompanhe notícias, documentos oficiais, dados de aposentadorias, pensões e segurados, e acesse nossos serviços digitais.</p>
        <div class="cta">
          <a class="btn primary" href="http://www.agendadatacenter.com.br/portalMirassoldoEste/Login/Login.aspx" target="_blank" rel="noopener">Portal do Segurado</a>
          <a class="btn ghost" href="#numeros">Ver números</a>
        </div>

        <div class="kpis" aria-label="Indicadores resumidos">
          <div class="kpi"><b id="kpi-aposentados">—</b><span>Aposentados</span></div>
          <div class="kpi"><b id="kpi-pensionistas">—</b><span>Pensionistas</span></div>
          <div class="kpi"><b id="kpi-segurados">—</b><span>Segurados</span></div>
        </div>
      </div>

      <div class="reveal">
        <img src="brasao.png" alt="Imagem institucional Mirassol-Previ" class="hero-img" loading="lazy"/>
      </div>
    </div>
  </section>

  <!-- ============================== NOTÍCIAS ================================== -->
  <section aria-labelledby="noticias-title" class="reveal">
    <div class="container">
      <h2 id="noticias-title" class="section-title">Notícias</h2>
      <div class="grid cards-3">
        <article class="card">
          <img src="divulgacao_audiencia.jpg" alt="Audiência pública Mirassol-Previ" loading="lazy"/>
          <div class="body">
            <span class="badge">Institucional</span>
            <h3>Audiência Pública apresenta resultados de 2024</h3>
            <p>Participe da audiência com transmissão ao vivo e acompanhe os resultados do exercício de 2024.</p>
            <div class="actions">
              <a class="link-btn" href="materia_audiencia.html" target="_blank" rel="noopener">Ler matéria</a>
            </div>
          </div>
        </article>

        <article class="card">
          <img src="materiaprovavida.png" alt="Prova de Vida obrigatória" loading="lazy"/>
          <div class="body">
            <span class="badge">Benefícios</span>
            <h3>Prova de Vida: regras e prazos do Decreto 5.146/2025</h3>
            <p>Entenda como realizar a comprovação anual e evite o bloqueio do benefício.</p>
            <div class="actions">
              <a class="link-btn" href="materia2.html" target="_blank" rel="noopener">Saiba mais</a>
            </div>
          </div>
        </article>

        <article class="card">
          <img src="10anos.jpeg" alt="Mirassol-Previ 10 Anos" loading="lazy"/>
          <div class="body">
            <span class="badge">Gestão</span>
            <h3>Mirassol-Previ celebra 10 anos</h3>
            <p>10 anos de atuação em prol da segurança previdenciária dos servidores municipais.</p>
            <div class="actions">
              <a class="link-btn" href="mirassol-previ-10-anos.html" target="_blank" rel="noopener">Leia a matéria</a>
            </div>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- ============================== NÚMEROS (JSON) ============================ -->
  <section id="numeros" class="reveal" aria-labelledby="numeros-title" style="background:#f5f9fc">
    <div class="container">
      <h2 id="numeros-title" class="section-title">Números de Aposentadorias, Pensões e Segurados</h2>

      <div style="overflow-x:auto">
        <table id="tabela-numeros">
          <thead>
            <tr id="thead-row"><!-- preenchido via JS --></tr>
          </thead>
          <tbody id="tbody-numeros"><!-- preenchido via JS --></tbody>
        </table>
      </div>

      <p id="sheet-status" style="color:var(--muted);font-size:13px;margin-top:10px">Carregando dados…</p>
    </div>
  </section>


    <!-- ============================== PATRIMÔNIO =============================== -->
  <section id="patrimonio" class="patrimonio reveal" aria-labelledby="patrimonio-title">
    <div class="container">
      <h2 id="patrimonio-title" class="section-title">Evolução Patrimonial Anual (R$)</h2>

      <div class="grafico-card">
        <div class="grafico-head">
          <h3>Patrimônio por ano</h3>
          <p>Valores anuais do patrimônio do Mirassol-Previ.</p>
        </div>

        <div id="patrimonio-chart" class="bar-chart" aria-label="Gráfico de evolução patrimonial anual"></div>
      </div>
    </div>
  </section>




  <!-- ============================== SERVIÇOS ================================== -->
  <section class="reveal" aria-labelledby="servicos-title">
    <div class="container">
      <h2 id="servicos-title" class="section-title">Serviços</h2>
      <div class="tiles">
        <div class="tile">
          <img src="PortaldoSegurado.png" alt="Portal do Segurado" loading="lazy"/>
          <a href="http://www.agendadatacenter.com.br/portalMirassoldoEste/Login/Login.aspx" target="_blank" rel="noopener">Portal do Segurado</a>
        </div>
        <div class="tile">
          <img src="digitalconsig.jpeg" alt="Digital Consig" loading="lazy"/>
          <a href="https://play.google.com/store/apps/details?id=br.com.digitalConsig" target="_blank" rel="noopener">Digital Consig</a>
        </div>
        <div class="tile">
          <img src="meurpps.png" alt="Meu RPPS" loading="lazy"/>
          <a href="https://play.google.com/store/apps/details?id=agendaassessoria.meurpps" target="_blank" rel="noopener">Meu RPPS</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================== LINKS ÚTEIS =============================== -->
  <section class="reveal" aria-labelledby="links-title" style="background:#f5f9fc">
    <div class="container">
      <h2 id="links-title" class="section-title">Links Úteis</h2>
      <div class="links">
        <a class="link-card" href="https://www.mirassoldoeste.mt.gov.br/" target="_blank" rel="noopener">
          <h3>Prefeitura Municipal</h3>
          <p>Portal oficial da Prefeitura de Mirassol D’Oeste.</p>
        </a>
        <a class="link-card" href="https://www.camaramirassoldoeste.mt.gov.br/" target="_blank" rel="noopener">
          <h3>Câmara Municipal</h3>
          <p>Trabalhos legislativos e sessões.</p>
        </a>
        <a class="link-card" href="https://www.saemi.com.br/" target="_blank" rel="noopener">
          <h3>SAEMI</h3>
          <p>Serviço de Água e Esgoto.</p>
        </a>
      </div>
    </div>
  </section>

  <!-- ============================== CONTATO =================================== -->
  <section class="reveal" aria-labelledby="contato-title">
    <div class="container">
      <h2 id="contato-title" class="section-title">Fale Conosco</h2>
      <div class="contact">
        <div class="card">
          <img src="whatsapp.png" alt="WhatsApp" style="width:40px;height:40px;margin:8px auto 6px"/>
          <h3>WhatsApp</h3>
          <p><a href="https://wa.me/5565998002383" target="_blank" rel="noopener">(65) 9 9800-2383</a></p>
        </div>
        <div class="card">
          <h3>E-mail</h3>
          <p><a href="mailto:mirassolprevi@mirassoldoeste.mt.gov.br">mirassolprevi@mirassoldoeste.mt.gov.br</a></p>
        </div>
        <div class="card">
          <h3>Endereço</h3>
          <p>Rua Juscelino Kubitschek, nº 3182 – Centro<br/>Mirassol D’Oeste – MT</p>
          <p><strong>Atendimento:</strong> Seg a Sex, 7h às 13h</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================== FOOTER ==================================== -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-wrap">
      <div style="display:flex;align-items:center;gap:10px">
        <img src="brasao.png" alt="Brasão de Mirassol D'Oeste" width="28" height="28"/>
        <span class="foot-note">© <span id="year"></span> Mirassol-Previ</span>
      </div>
      <a href="#top" class="foot-note">Voltar ao topo</a>
    </div>
  </footer>

  <!-- WhatsApp flutuante -->
  <a href="https://wa.me/5565998002383" class="whatsapp-float" target="_blank" rel="noopener" title="Fale conosco pelo WhatsApp">
    <img src="whatsapp.png" alt="Ícone WhatsApp"/>
  </a>

  <!-- ================================ JS ====================================== -->
  <script>
    // Ano dinâmico no rodapé
    document.getElementById('year').textContent = new Date().getFullYear();

    // Menu mobile: abre/fecha dropdown
    const hamb = document.querySelector('.hamb');
    const menu = document.getElementById('menu');
    hamb?.addEventListener('click', ()=>{
      const open = menu.classList.toggle('show');
      hamb.setAttribute('aria-expanded', String(open));
    });

    // Submenu em mobile: botão abre/fecha
    document.querySelectorAll('.has-sub > button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const parent = btn.closest('.has-sub');
        const isOpen = parent.classList.toggle('open');
        btn.setAttribute('aria-expanded', String(isOpen));
      });
    });

    // Scroll reveal simples
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));

    // ===================== DADOS (dados.json, sem CORS) =======================
    async function fetchDados(){
      const status = document.getElementById('sheet-status');
      try{
        const res = await fetch('./dados.json', { cache:'no-store' });
        const dados = await res.json();
        renderKPIs(dados);
        renderTable(dados);
        if(status) status.textContent = 'Dados carregados de dados.json (local).';
      }catch(err){
        console.warn('Erro ao carregar dados.json', err);
        if(status) status.textContent = 'Não foi possível carregar dados.json.';
      }
    }

    // Último valor numérico (ano mais recente -> mais antigo)
    function lastValue(obj){
      const anos = Object.keys(obj||{}).sort();
      for(let i=anos.length-1;i>=0;i--){
        const raw = obj[anos[i]];
        if (raw === null || raw === undefined || raw === '') continue;
        const n = Number(String(raw).replace(/\./g,'').replace(',','.'));
        if(Number.isFinite(n)) return n;
      }
      return null;
    }

    // Preenche KPIs (agora incluindo segurados)
    function renderKPIs(dados){
      const a = lastValue(dados.aposentados||{});
      const p = lastValue(dados.pensionistas||{});
      const s = lastValue(dados.segurados||{});

      if(a!=null) document.getElementById('kpi-aposentados').textContent = String(a);
      if(p!=null) document.getElementById('kpi-pensionistas').textContent = String(p);
      if(s!=null) document.getElementById('kpi-segurados').textContent = String(s);
    }

    // Monta tabela (anos nas colunas, três linhas: Aposentados, Pensionistas, Segurados)
    function renderTable(dados){
      const thead = document.getElementById('thead-row');
      const tbody = document.getElementById('tbody-numeros');
      if(!thead || !tbody) return;

      thead.innerHTML = '';
      tbody.innerHTML = '';

      const anos = Object.keys(dados.aposentados || {}).sort();

      // Cabeçalho
      const thCat = document.createElement('th');
      thCat.textContent = 'Categoria';
      thCat.style.padding='12px 16px';
      thCat.style.textAlign='left';
      thead.appendChild(thCat);

      anos.forEach(ano=>{
        const th = document.createElement('th');
        th.textContent = ano;
        th.style.padding='12px 10px';
        th.style.textAlign='center';
        thead.appendChild(th);
      });

      // Função auxiliar para criar linhas
      function addRow(label, dataset){
        const tr = document.createElement('tr');
        const th = document.createElement('th');
        th.textContent = label;
        th.style.background='#f1f5f9';
        th.style.color='var(--brand-900)';
        th.style.textAlign='left';
        tr.appendChild(th);

        anos.forEach(ano=>{
          const td = document.createElement('td');
          td.textContent = (dataset?.[ano] ?? '');
          td.style.textAlign='center';
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      }

      addRow('Aposentados', dados.aposentados);
      addRow('Pensionistas', dados.pensionistas);
      addRow('Segurados', dados.segurados);
    }
    // ===================== PATRIMÔNIO (patrimonio_anual.json) ==================
    function formatBRL(num){
      try{
        return Number(num).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      }catch(e){
        return String(num);
      }
    }

        async function carregarPatrimonio(){
      const chart = document.getElementById('patrimonio-chart');
      if(!chart) return;

      function formatBRL(num){
        try{
          return Number(num).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }catch(e){
          return String(num);
        }
      }

      try{
        const res = await fetch('./patrimonio_anual.json', { cache:'no-store' });
        if(!res.ok) throw new Error('Não foi possível carregar patrimonio_anual.json');
        const json = await res.json();

        const dados = Array.isArray(json?.dados) ? json.dados : [];
        if(!dados.length) return;

        dados.sort((a,b)=>(a.ano||0)-(b.ano||0));

        // define colunas automaticamente pelo nº de anos
        chart.style.gridTemplateColumns = `repeat(${dados.length}, minmax(0, 1fr))`;

        const max = Math.max(...dados.map(d => Number(d.valor || 0)));

        chart.innerHTML = '';
        dados.forEach(d => {
          const ano = d.ano;
          const valor = Number(d.valor || 0);

          const item = document.createElement('div');
          item.className = 'bar-item';

          const valueEl = document.createElement('div');
          valueEl.className = 'bar-value';
          valueEl.textContent = formatBRL(valor);

          const bar = document.createElement('div');
          bar.className = 'bar';

          const pct = max > 0 ? (valor / max) : 0;
          const h = Math.max(10, Math.round(pct * 320));
          bar.style.height = h + 'px';
          bar.title = `${ano}: ${formatBRL(valor)}`;

          const yearEl = document.createElement('div');
          yearEl.className = 'bar-year';
          yearEl.textContent = ano;

          item.appendChild(valueEl);
          item.appendChild(bar);
          item.appendChild(yearEl);
          chart.appendChild(item);
        });
      }catch(err){
        console.warn('Erro ao carregar patrimonio_anual.json', err);
        chart.innerHTML = '';
      }
    }

        dados.sort((a,b)=>(a.ano||0)-(b.ano||0));
        const max = Math.max(...dados.map(d => Number(d.valor || 0)));

        chart.innerHTML = '';
        dados.forEach(d => {
          const ano = d.ano;
          const valor = Number(d.valor || 0);

          const item = document.createElement('div');
          item.className = 'bar-item';

          const valueEl = document.createElement('div');
          valueEl.className = 'bar-value';
          valueEl.textContent = formatBRL(valor);

          const bar = document.createElement('div');
          bar.className = 'bar';

          // Escala visual: altura máxima ~320px
          const pct = max > 0 ? (valor / max) : 0;
          const h = Math.max(8, Math.round(pct * 320));
          bar.style.height = h + 'px';
          bar.title = `${ano}: ${formatBRL(valor)}`;

          const yearEl = document.createElement('div');
          yearEl.className = 'bar-year';
          yearEl.textContent = ano;

          item.appendChild(valueEl);
          item.appendChild(bar);
          item.appendChild(yearEl);
          chart.appendChild(item);
        });

        if(status) status.textContent = 'Gráfico carregado de patrimonio_anual.json.';
      }catch(err){
        console.warn('Erro ao carregar patrimonio_anual.json', err);
        if(status) status.textContent = 'Não foi possível carregar patrimonio_anual.json.';
        chart.innerHTML = '';
      }
    }



    // Inicia
    fetchDados();
    carregarPatrimonio();
  </script>
</body>
</html>
