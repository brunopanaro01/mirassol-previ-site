<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consignados ‚Äî Mirassol-Previ</title>
  <meta name="description" content="Consignados do Mirassol-Previ ‚Äî regulamentos e relat√≥rios por ano e m√™s."/>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand-900:#01385f;
      --brand-800:#014c85;
      --bg:#f7fafc;
      --paper:#fff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --soft:#f3f7fb;
      --shadow:0 10px 30px rgba(2,8,23,.08);
      --warn:#b45309;
      --ok:#0f766e;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--ink);line-height:1.6}
    a{color:var(--brand-800);text-decoration:none}
    img{max-width:100%;height:auto;display:block}

    /* Anti-popup (igual ao modelo) */
    #popup,.popup,.modal,.modal-backdrop,[role="dialog"],.overlay,.newsletter-modal,.cookie-modal{display:none!important}
    body.modal-open{overflow:auto!important}

    /* Cabe√ßalho (igual ao modelo) */
    header.site-header{position:sticky;top:0;z-index:100;background:#fff;border-bottom:1px solid var(--line)}
    .header-wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:52px;height:52px}
    .brand .titles{display:flex;flex-direction:column}
    .brand .titles h1{margin:0;font-size:20px;color:var(--brand-800)}
    .brand .titles small{font-size:12px;color:var(--muted)}
    nav.primary{margin-left:auto;position:relative}
    .menu{display:flex;gap:8px;align-items:center}
    .menu a,.menu button{padding:10px 12px;border-radius:10px;color:var(--ink);background:transparent;border:0;font:inherit;cursor:pointer}
    .menu a:hover,.menu button:hover{background:#eef5fb}
    .menu a.active{background:#eef5fb}

    /* Submenu ‚ÄúInstitucional‚Äù (igual ao modelo) */
    .has-sub{position:relative}
    .has-sub > button{display:inline-flex;align-items:center;gap:6px}
    .submenu{
      display:none;position:absolute;top:100%;left:0;z-index:101;
      background:#fff;border:1px solid var(--line);border-radius:12px;
      box-shadow:var(--shadow);min-width:260px;padding:6px
    }
    .submenu a{display:block;padding:10px 12px;border-radius:8px}
    .submenu a:hover{background:var(--soft)}
    .has-sub:hover .submenu,
    .has-sub:focus-within .submenu{display:block}

    /* Bot√£o hamb√∫rguer (igual ao modelo) */
    .hamb{display:none;background:none;border:0;padding:8px;border-radius:10px;cursor:pointer}
    .hamb:hover{background:#eef5fb}

    /* Conte√∫do (igual ao modelo) */
    main{padding:40px 16px}
    .container{max-width:1200px;margin:0 auto}
    h1.page-title{text-align:center;font-size:clamp(1.6rem,1.2rem + 1vw,2.2rem);color:var(--brand-900);margin:0 0 14px}
    .lead{max-width:980px;margin:0 auto 18px;color:var(--muted);text-align:center}

    /* Aviso de links externos (igual ao modelo) */
    .notice{
      max-width:980px;margin:0 auto 20px;
      background:#fff;border:1px solid var(--line);border-left:6px solid var(--warn);
      border-radius:14px;box-shadow:var(--shadow);padding:14px 16px
    }
    .notice strong{display:block;color:#7c2d12;margin-bottom:4px}
    .notice p{margin:0;color:var(--muted);font-size:14px}
    .notice code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.95em}

    /* Layout lateral */
    .layout{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:18px;
      align-items:start;
      margin-top:18px;
    }
    .side{
      background:var(--paper);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:14px;
      position:sticky;
      top:92px;
    }
    .side h2{
      margin:6px 0 4px;
      font-size:14px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:#334155
    }
    .side p{margin:0 0 12px;color:var(--muted);font-size:13px}

    .tabs{display:flex;flex-direction:column;gap:8px}
    .tab-btn{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font:inherit;
      color:var(--ink);
    }
    .tab-btn:hover{background:var(--soft)}
    .tab-btn.active{background:#eef5fb;border-color:#cfe2f3}
    .tab-meta{font-size:12px;color:var(--muted)}

    .panel{
      background:var(--paper);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:18px;
      min-height:520px;
    }

    .panel-title{margin:0 0 6px;font-size:18px;color:var(--brand-900)}
    .muted{color:var(--muted);font-size:13px;margin:0}

    /* Imagem central */
    .center-card{
      display:flex;
      justify-content:center;
      align-items:center;
      padding:12px;
      border:1px dashed var(--line);
      border-radius:14px;
      background:var(--soft);
      margin-top:12px;
    }
    .center-card img{
      max-width:820px;width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
    }

    /* Tabelas */
    .table-wrap{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
      margin-top:12px;
    }
    table{width:100%;border-collapse:collapse}
    thead th{
      text-align:left;
      background:var(--soft);
      border-bottom:1px solid var(--line);
      padding:12px;
      font-size:13px;
      color:#334155;
    }
    tbody td{
      padding:12px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:14px;
    }
    tbody tr:last-child td{border-bottom:none}

    .badge{
      display:inline-block;
      font-size:12px;
      color:#0f172a;
      background:var(--soft);
      border:1px solid var(--line);
      padding:4px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    .badge.external{border-left:4px solid var(--warn)}
    .badge.internal{border-left:4px solid var(--ok)}

    /* Bot√µes padr√£o do portal (reuso do estilo ‚Äúpill‚Äù) */
    .pill{
      border:1px solid var(--line);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font:inherit;
      font-weight:600;
    }
    .pill:hover{background:var(--soft)}
    .pill.active{background:#eef5fb;border-color:#cfe2f3}

    .year-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}

    .empty{padding:14px;color:var(--muted);font-size:14px}

    /* Visualizador (iframe) */
    .viewer{
      display:none;
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
    }
    .viewer-head{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      padding:12px 12px;
      background:var(--soft);
      border-bottom:1px solid var(--line);
      flex-wrap:wrap;
    }
    .viewer-head strong{color:var(--brand-900)}
    .viewer-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .viewer iframe{width:100%;height:72vh;border:0;background:#fff}

    /* Scroll reveal (igual ao modelo) */
    .reveal{opacity:0;transform:translateY(14px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:none}

    /* Rodap√© (igual ao modelo) */
    footer.site-footer{background:#0d2636;color:#cbd5e1;margin-top:40px}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:20px 16px;text-align:center}

    /* Mobile (igual ao modelo + layout lateral) */
    @media(max-width:860px){
      .hamb{display:inline-grid;place-items:center}
      .menu{
        display:none;position:absolute;top:64px;right:16px;background:#fff;border:1px solid var(--line);
        box-shadow:var(--shadow);padding:8px;border-radius:12px;flex-direction:column;min-width:280px
      }
      .menu.show{display:flex}
      .brand .titles h1{font-size:18px}
      .brand img{width:44px;height:44px}
      .has-sub .submenu{position:static;box-shadow:none;border:0;padding:0;margin-left:8px;margin-bottom:8px;display:none}
      .has-sub.open .submenu{display:block}

      .layout{grid-template-columns:1fr}
      .side{position:relative;top:auto}
      .viewer iframe{height:64vh}
    }
  </style>
</head>

<body>
  <!-- Cabe√ßalho (mesmo do modelo) -->
  <header class="site-header">
    <div class="header-wrap">
      <a class="brand" href="index.html" aria-label="Ir para a p√°gina inicial">
        <img src="brasao.png" alt="Bras√£o de Mirassol D'Oeste"/>
        <span class="titles">
          <h1>Mirassol-Previ</h1>
          <small>Fundo Municipal de Previd√™ncia Social ‚Äî Mirassol D‚ÄôOeste/MT</small>
        </span>
      </a>

      <button class="hamb" aria-label="Abrir menu" aria-controls="menu" aria-expanded="false">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav class="primary" aria-label="Menu principal">
        <div id="menu" class="menu" role="menubar">
          <a role="menuitem" href="index.html">In√≠cio</a>
          <div class="has-sub" role="none">
            <button aria-haspopup="true" aria-expanded="false">Institucional ‚ñæ</button>
            <div class="submenu" role="menu">
              <a role="menuitem" href="historia.html">Hist√≥ria</a>
              <a role="menuitem" href="identidade.html">Identidade</a>
              <a role="menuitem" href="composicao.html">Composi√ß√£o</a>
              <a role="menuitem" href="organograma.html">Organograma</a>
            </div>
          </div>
          <a role="menuitem" href="aposentadorias.html">Aposentadorias</a>
          <a role="menuitem" href="transparencia.html">Transpar√™ncia</a>
          <a role="menuitem" href="progestao.html">Pr√≥-Gest√£o</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Conte√∫do -->
  <main>
    <div class="container">
      <h1 class="page-title reveal">Consignados</h1>
      <p class="lead reveal">
        Para contrata√ß√£o, utilize os contatos exibidos na imagem do In√≠cio.
        Regulamentos e relat√≥rios podem ser visualizados na pr√≥pria p√°gina.
      </p>

      <!-- Aviso (mant√©m o padr√£o do portal) -->
      <div class="notice reveal" role="note" aria-label="Aviso sobre links externos">
        <strong>üîî Aviso importante</strong>
        <p>
          Itens marcados como <code>Portal externo</code> s√£o documentos hospedados fora do dom√≠nio do Mirassol-Previ (Google Drive).
          Eles podem ser <strong>visualizados aqui</strong> por iframe, e voc√™ tamb√©m pode optar por <strong>abrir em nova aba</strong> (‚Üó).
        </p>
      </div>

      <div class="layout">
        <!-- Lateral -->
        <aside class="side reveal" aria-label="Menu lateral de Consignados">
          <h2>Acesso r√°pido</h2>
          <p>Selecione uma op√ß√£o para visualizar o conte√∫do.</p>

          <div class="tabs">
            <button class="tab-btn active" id="tab-inicio" type="button" onclick="showTab('inicio')">
              In√≠cio <span class="tab-meta">imagem</span>
            </button>
            <button class="tab-btn" id="tab-regulamento" type="button" onclick="showTab('regulamento')">
              Regulamento <span class="tab-meta">tabela</span>
            </button>
            <button class="tab-btn" id="tab-relatorios" type="button" onclick="showTab('relatorios')">
              Relat√≥rios <span class="tab-meta">ano/m√™s</span>
            </button>
          </div>
        </aside>

        <!-- Painel -->
        <section class="panel reveal" aria-label="Conte√∫do de Consignados">
          <!-- IN√çCIO -->
          <div id="pane-inicio">
            <h2 class="panel-title">Contatos para contrata√ß√£o</h2>
            <p class="muted">A imagem abaixo cont√©m os dados de contato para contrata√ß√£o de consignado.</p>

            <div class="center-card">
              <img src="consignado.jpeg" alt="Consignado ‚Äî contatos para contrata√ß√£o"/>
            </div>
          </div>

          <!-- REGULAMENTO -->
          <div id="pane-regulamento" style="display:none;">
            <h2 class="panel-title">Regulamento</h2>
            <p class="muted">Documentos normativos relacionados ao consignado (visualiza√ß√£o interna dispon√≠vel).</p>

            <div class="table-wrap" aria-label="Tabela de regulamentos">
              <table>
                <thead>
                  <tr>
                    <th style="width:60%;">Documento</th>
                    <th style="width:20%;">Origem</th>
                    <th style="width:20%;">A√ß√£o</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Ata de Altera√ß√£o do Consignado</td>
                    <td><span class="badge external">Portal externo</span></td>
                    <td>
                      <button class="pill" type="button"
                        onclick="openPdfInPage('Ata de Altera√ß√£o do Consignado','https://drive.google.com/file/d/1398alFuUue0LnfYUrse9dnXQmuTdS9Oi/view?usp=sharing')">
                        Visualizar
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>Estudo Atuarial</td>
                    <td><span class="badge external">Portal externo</span></td>
                    <td>
                      <button class="pill" type="button"
                        onclick="openPdfInPage('Estudo Atuarial','https://drive.google.com/file/d/1fsBJk7-yo-mXBcnDTM6O-RSulk0ae9Vh/view?usp=sharing')">
                        Visualizar
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>PORTARIA N. 001 de 26 de fevereiro de 2025</td>
                    <td><span class="badge external">Portal externo</span></td>
                    <td>
                      <button class="pill" type="button"
                        onclick="openPdfInPage('PORTARIA N. 001 de 26 de fevereiro de 2025','https://drive.google.com/file/d/15rNn73VeF8vkU3dXOOZ7Bqa8bCEk5W5Z/view?usp=sharing')">
                        Visualizar
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>PORTARIA N.¬∫ 013 de 03 de dezembro de 2024 (Regulamento)</td>
                    <td><span class="badge external">Portal externo</span></td>
                    <td>
                      <button class="pill" type="button"
                        onclick="openPdfInPage('PORTARIA N.¬∫ 013 de 03 de dezembro de 2024','https://drive.google.com/file/d/1UQef_0Z0Sq2rQH1GZcA3_IbzZTP23PVE/view?usp=sharing')">
                        Visualizar
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- RELAT√ìRIOS -->
          <div id="pane-relatorios" style="display:none;">
            <h2 class="panel-title">Relat√≥rios</h2>
            <p class="muted">Selecione o ano para visualizar os meses dispon√≠veis (dados carregados de <strong>consignados.json</strong>).</p>

            <div class="year-row" id="year-row" aria-label="Sele√ß√£o de ano"></div>

            <div class="table-wrap" aria-label="Tabela de relat√≥rios">
              <table>
                <thead>
                  <tr>
                    <th style="width:35%;">M√™s</th>
                    <th style="width:45%;">Descri√ß√£o</th>
                    <th style="width:20%;">A√ß√£o</th>
                  </tr>
                </thead>
                <tbody id="reports-body"></tbody>
              </table>
              <div class="empty" id="reports-empty" style="display:none;">Nenhum relat√≥rio cadastrado para este ano.</div>
            </div>
          </div>

          <!-- VISUALIZADOR (iframe) -->
          <div id="pdf-viewer" class="viewer" aria-label="Visualizador de PDF">
            <div class="viewer-head">
              <div>
                <strong id="pdf-title">Documento</strong>
                <div class="muted" style="margin-top:2px;">
                  Conte√∫do hospedado em <span class="badge external">Portal externo</span>.
                  Se preferir, use <strong>Abrir em nova aba</strong> (‚Üó).
                </div>
              </div>

              <div class="viewer-actions">
                <a id="pdf-open-newtab" class="pill" href="#" target="_blank" rel="noopener">Abrir em nova aba ‚Üó</a>
                <button class="pill" type="button" onclick="closePdfViewer()">Fechar</button>
              </div>
            </div>

            <iframe id="pdf-iframe" title="Documento (visualiza√ß√£o)" loading="lazy"></iframe>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Rodap√© (mesmo do modelo) -->
  <footer class="site-footer">
    <div class="footer-wrap">
      <span>¬© <span id="year"></span> Mirassol-Previ</span>
    </div>
  </footer>

  <script>
    // Ano din√¢mico (igual ao modelo) :contentReference[oaicite:3]{index=3}
    document.getElementById('year').textContent = new Date().getFullYear();

    // Scroll reveal (igual ao modelo) :contentReference[oaicite:4]{index=4}
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));

    // Menu mobile (igual ao modelo) :contentReference[oaicite:5]{index=5}
    const hamb = document.querySelector('.hamb');
    const menu = document.getElementById('menu');
    hamb?.addEventListener('click', ()=>{
      const open = menu.classList.toggle('show');
      hamb.setAttribute('aria-expanded', String(open));
    });

    // Submenu institucional (mobile) (igual ao modelo) :contentReference[oaicite:6]{index=6}
    document.querySelectorAll('.has-sub > button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const parent = btn.closest('.has-sub');
        const isOpen = parent.classList.toggle('open');
        btn.setAttribute('aria-expanded', String(isOpen));
      });
    });

    // Tabs laterais
    function setActiveTab(id){
      ['tab-inicio','tab-regulamento','tab-relatorios'].forEach(t=>{
        document.getElementById(t).classList.remove('active');
      });
      document.getElementById(id).classList.add('active');
    }
    function showTab(which){
      document.getElementById('pane-inicio').style.display = (which==='inicio') ? 'block' : 'none';
      document.getElementById('pane-regulamento').style.display = (which==='regulamento') ? 'block' : 'none';
      document.getElementById('pane-relatorios').style.display = (which==='relatorios') ? 'block' : 'none';

      // Ao trocar de aba, fecha o viewer para n√£o ficar ‚Äúsobrando‚Äù
      closePdfViewer(false);

      if(which==='inicio') setActiveTab('tab-inicio');
      if(which==='regulamento') setActiveTab('tab-regulamento');
      if(which==='relatorios') setActiveTab('tab-relatorios');
    }

    // ===== Visualizador Google Drive (iframe /preview) =====
    function getDriveFileId(url){
      const m1 = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
      if(m1 && m1[1]) return m1[1];
      const m2 = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
      if(m2 && m2[1]) return m2[1];
      return null;
    }
    function toDrivePreviewUrl(url){
      const id = getDriveFileId(url);
      if(!id) return url;
      return `https://drive.google.com/file/d/${id}/preview`;
    }

    function openPdfInPage(title, driveUrl){
      const viewer = document.getElementById('pdf-viewer');
      const iframe = document.getElementById('pdf-iframe');
      const ttl = document.getElementById('pdf-title');
      const newTab = document.getElementById('pdf-open-newtab');

      ttl.textContent = title || 'Documento';
      newTab.href = driveUrl;

      iframe.src = toDrivePreviewUrl(driveUrl);
      viewer.style.display = 'block';

      // rola at√© o viewer (bom p/ mobile)
      viewer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function closePdfViewer(scrollBack=true){
      const viewer = document.getElementById('pdf-viewer');
      const iframe = document.getElementById('pdf-iframe');
      if(viewer.style.display === 'none' || viewer.style.display === '') return;

      iframe.src = '';
      viewer.style.display = 'none';

      if(scrollBack){
        // opcional: volta para o topo do painel
        document.querySelector('.panel')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // ===== Relat√≥rios via JSON =====
    const JSON_URL = "consignados.json";
    let data = null;
    let selectedYear = null;

    const yearRow = document.getElementById('year-row');
    const body = document.getElementById('reports-body');
    const empty = document.getElementById('reports-empty');

    function renderYears(){
      yearRow.innerHTML = '';
      const years = Object.keys((data && data.relatorios) ? data.relatorios : {}).sort();
      years.forEach(y=>{
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'pill';
        btn.textContent = y;
        btn.addEventListener('click', ()=>selectYear(y));
        yearRow.appendChild(btn);
      });

      if(years.length){
        selectYear(years[years.length - 1]); // ano mais recente
      }
    }

    function setActiveYearBtn(year){
      document.querySelectorAll('#year-row .pill').forEach(b=>{
        b.classList.toggle('active', b.textContent === String(year));
      });
    }

    function selectYear(year){
      selectedYear = String(year);
      setActiveYearBtn(selectedYear);

      body.innerHTML = '';
      const list = data?.relatorios?.[selectedYear];

      if(!list || !Array.isArray(list) || list.length === 0){
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      list.forEach(item=>{
        const tr = document.createElement('tr');

        const tdMes = document.createElement('td');
        tdMes.textContent = item.mes;

        const tdDesc = document.createElement('td');
        tdDesc.textContent = item.descricao || 'Relat√≥rio de consignados';

        const tdAction = document.createElement('td');
        if(item.url && item.url.trim()){
          // Visualiza na p√°gina (iframe)
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'pill';
          btn.textContent = 'Visualizar';
          btn.addEventListener('click', () => openPdfInPage(item.descricao || 'Relat√≥rio', item.url));
          tdAction.appendChild(btn);
        }else{
          tdAction.innerHTML = '<span class="badge internal">No portal</span> <span class="muted">Em breve</span>';
        }

        tr.appendChild(tdMes);
        tr.appendChild(tdDesc);
        tr.appendChild(tdAction);
        body.appendChild(tr);
      });
    }

    async function loadReports(){
      try{
        const res = await fetch(JSON_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('Falha ao carregar JSON: ' + res.status);
        data = await res.json();
        renderYears();
      }catch(err){
        console.error(err);
        yearRow.innerHTML = '<span class="muted">N√£o foi poss√≠vel carregar <strong>consignados.json</strong>. Verifique se o arquivo est√° na mesma pasta.</span>';
        empty.style.display = 'block';
      }
    }

    loadReports();
  </script>
</body>
</html>
